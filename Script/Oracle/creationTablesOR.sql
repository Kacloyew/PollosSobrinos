-- 1. ELIMINAR TABLAS
DROP TABLE Pedidos CASCADE CONSTRAINTS;
DROP TABLE Empleados CASCADE CONSTRAINTS;
DROP TABLE Clientes CASCADE CONSTRAINTS;
DROP TABLE Productos CASCADE CONSTRAINTS;
DROP TABLE Proveedores CASCADE CONSTRAINTS;
DROP TABLE Tiendas CASCADE CONSTRAINTS;

-- 2. CREAR TABLAS
CREATE TABLE Tiendas (
    Tienda_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Nombre_tienda VARCHAR2(100) NOT NULL,
    Direccion VARCHAR2(255),
    Telefono VARCHAR2(20),
    CorreoElectronico VARCHAR2(100)
);

CREATE TABLE Proveedores (
    Proveedor_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Nombre VARCHAR2(100) NOT NULL,
    NIF_NIE_CIF VARCHAR2(20) NOT NULL UNIQUE,
    Telefono VARCHAR2(20),
    CorreoElectronico VARCHAR2(100),
    Direccion VARCHAR2(255),
    Tienda_ID NUMBER
);

CREATE TABLE Productos (
    Producto_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Nombre VARCHAR2(100) NOT NULL,
    Precio NUMBER(10,2) NOT NULL,
    Stock NUMBER DEFAULT 0,
    Proveedor_ID NUMBER
);

CREATE TABLE Clientes (
    Cliente_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Nombre VARCHAR2(50) NOT NULL,
    Apellido VARCHAR2(50) NOT NULL,
    NIF_NIE VARCHAR2(20) NOT NULL UNIQUE,
    Telefono VARCHAR2(20),
    CorreoElectronico VARCHAR2(100),
    Tienda_ID NUMBER
);

CREATE TABLE Empleados (
    Empleado_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Nombre VARCHAR2(50) NOT NULL,
    Apellido VARCHAR2(50) NOT NULL,
    NIF_NIE VARCHAR2(20) NOT NULL UNIQUE,
    Telefono VARCHAR2(20),
    CorreoElectronico VARCHAR2(100),
    Puesto VARCHAR2(50),
    Salario NUMBER(10,2),
    Tienda_ID NUMBER
);

CREATE TABLE Pedidos (
    Pedido_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Empleado_ID NUMBER,
    Tienda_ID NUMBER,
    Cliente_ID NUMBER,
    Producto_ID NUMBER,
    Fecha_Pedido TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    Cantidad NUMBER DEFAULT 1
);

-- 3. AGREGAR CLAVES FOR√ÅNEAS
ALTER TABLE Proveedores
    ADD CONSTRAINT fk_proveedor_tienda
    FOREIGN KEY (Tienda_ID) REFERENCES Tiendas(Tienda_ID) ON DELETE SET NULL;

ALTER TABLE Productos
    ADD CONSTRAINT fk_producto_proveedor
    FOREIGN KEY (Proveedor_ID) REFERENCES Proveedores(Proveedor_ID) ON DELETE SET NULL;

ALTER TABLE Clientes
    ADD CONSTRAINT fk_cliente_tienda
    FOREIGN KEY (Tienda_ID) REFERENCES Tiendas(Tienda_ID) ON DELETE SET NULL;

ALTER TABLE Empleados
    ADD CONSTRAINT fk_empleado_tienda
    FOREIGN KEY (Tienda_ID) REFERENCES Tiendas(Tienda_ID) ON DELETE SET NULL;

ALTER TABLE Pedidos
    ADD CONSTRAINT fk_pedido_empleado
    FOREIGN KEY (Empleado_ID) REFERENCES Empleados(Empleado_ID) ON DELETE SET NULL;

ALTER TABLE Pedidos
    ADD CONSTRAINT fk_pedido_tienda
    FOREIGN KEY (Tienda_ID) REFERENCES Tiendas(Tienda_ID) ON DELETE SET NULL;

ALTER TABLE Pedidos
    ADD CONSTRAINT fk_pedido_cliente
    FOREIGN KEY (Cliente_ID) REFERENCES Clientes(Cliente_ID) ON DELETE SET NULL;

ALTER TABLE Pedidos
    ADD CONSTRAINT fk_pedido_producto
    FOREIGN KEY (Producto_ID) REFERENCES Productos(Producto_ID) ON DELETE SET NULL;

COMMIT;
